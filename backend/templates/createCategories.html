<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">

    <title>{{title}}</title>
</head>

<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>GroceryApp</h2>
            <span class="close-btn" id="closeSidebar">✕</span>
        </div>

        <a href="/main">Dashboard</a>
        <a href="/addProducts">Add Products</a>
        <a href="#orders">Orders</a>
        <a href="/createCategories">Categories</a>
        <a href="#">Users</a>
        <a href="#">Profile</a>
    </div>
    <div class="topbar">
        <span class="menu-btn" id="openSidebar">☰</span>
        <h1>Admin Panel</h1>
    </div>
    <section>
        <h2>Create Categories</h2>
        <form id="categoriesForm" action="/categories/add" method="post">
            <label>Category Name:</label><br>
            <input type="text" id="category_name" name="category_name" required><br><br>



            <button type="submit">Add Category</button>
        </form>
    </section>
    <script src="/static/js/script.js"></script>
    
    <script src="/static/js/add.js"></script>
    <script>
document.getElementById("categoriesForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // stop page reload

    const name = document.getElementById("category_name").value.trim();
    if (!name) return alert("Category name is required!");

    const formData = new FormData();
    formData.append("category_name", name);

    try {
        const res = await fetch("/categories/add", {
            method: "POST",
            body: formData
        });

        // If category added successfully
        if (res.redirected && res.url.includes("success=1")) {
            alert("Category Added Successfully!");
            loadCategories();         // Refresh list after add
            document.getElementById("category_name").value = "";
            return;
        }

        // If duplicate
        if (res.redirected && res.url.includes("error")) {
            const errorMsg = new URL(res.url).searchParams.get("error");
            alert(errorMsg);
            return;
        }

        alert("Something went wrong!");
    } 
    catch (err) {
        alert("Failed to connect server");
    }
});

// Load categories from DB
async function loadCategories(){
    const res = await fetch("/categories");
    const data = await res.json();

    const container = document.getElementById("categoryList");
    container.innerHTML = "<ul>" + data.map(c => `<li>${c.name}</li>`).join("") + "</ul>";
}

// Load on page start
loadCategories();
</script>
    <main>
            <!-- Categories view start  -->
            <br>
            <h2>Categories</h2>
            <div class="table-container" id="categories">
                <div id="categoryList">
                    <!-- Categories will be loaded here dynamically -->
                </div>
            </div>
            

</body>

</html>